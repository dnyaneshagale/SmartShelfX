<h2 mat-dialog-title>
    <mat-icon [class]="data.type === 'STOCK_IN' ? 'stock-in' : 'stock-out'">{{getDialogIcon()}}</mat-icon>
    {{getDialogTitle()}}
</h2>

<mat-dialog-content>
    <div *ngIf="isLoading" class="loading-spinner">
        <mat-spinner diameter="30"></mat-spinner>
    </div>

    <form [formGroup]="stockForm" *ngIf="!isLoading">
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Product</mat-label>
            <mat-select formControlName="productId">
                <mat-option *ngFor="let product of products" [value]="product.id">
                    {{product.name}} (SKU: {{product.sku}}) - Current: {{product.currentStock}}
                </mat-option>
            </mat-select>
            <mat-error *ngIf="stockForm.get('productId')?.hasError('required')">Product is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" formControlName="quantity" min="1">
            <mat-icon matPrefix>{{data.type === 'STOCK_IN' ? 'add' : 'remove'}}</mat-icon>
            <mat-error *ngIf="stockForm.get('quantity')?.hasError('required')">Quantity is required</mat-error>
            <mat-error *ngIf="stockForm.get('quantity')?.hasError('min')">Quantity must be at least 1</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Reason</mat-label>
            <mat-select formControlName="reason">
                <ng-container *ngIf="data.type === 'STOCK_IN'">
                    <mat-option value="Purchase Order">Purchase Order</mat-option>
                    <mat-option value="Return from Customer">Return from Customer</mat-option>
                    <mat-option value="Transfer In">Transfer In</mat-option>
                    <mat-option value="Inventory Adjustment">Inventory Adjustment</mat-option>
                    <mat-option value="Other">Other</mat-option>
                </ng-container>
                <ng-container *ngIf="data.type === 'STOCK_OUT'">
                    <mat-option value="Sale">Sale</mat-option>
                    <mat-option value="Dispatch">Dispatch</mat-option>
                    <mat-option value="Transfer Out">Transfer Out</mat-option>
                    <mat-option value="Damaged/Expired">Damaged/Expired</mat-option>
                    <mat-option value="Inventory Adjustment">Inventory Adjustment</mat-option>
                    <mat-option value="Other">Other</mat-option>
                </ng-container>
            </mat-select>
            <mat-error *ngIf="stockForm.get('reason')?.hasError('required')">Reason is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Reference (Optional)</mat-label>
            <input matInput formControlName="reference" placeholder="Invoice #, PO #, etc.">
            <mat-icon matPrefix>description</mat-icon>
        </mat-form-field>
    </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="isSubmitting">Cancel</button>
    <button mat-raised-button [color]="data.type === 'STOCK_IN' ? 'primary' : 'warn'" (click)="onSubmit()"
        [disabled]="stockForm.invalid || isSubmitting">
        <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
        <span *ngIf="!isSubmitting">{{data.type === 'STOCK_IN' ? 'Add Stock' : 'Remove Stock'}}</span>
    </button>
</mat-dialog-actions>